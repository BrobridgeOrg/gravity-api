syntax = "proto3";

package gravity.api.controller;

service Controller {

  // Core
  rpc GetClientCount(GetClientCountRequest) returns (GetClientCountReply) {}
  rpc GetPipelineCount(GetPipelineCountRequest) returns (GetPipelineCountReply) {}
  rpc Register(RegisterRequest) returns (RegisterReply) {}
  rpc Unregister(UnregisterRequest) returns (UnregisterReply) {}
  rpc ReleasePipelines(ReleasePipelinesRequest) returns (ReleasePipelinesReply) {}
  rpc GetPipelines(GetPipelinesRequest) returns (GetPipelinesReply) {}

  // Adapter
  rpc RegisterAdapter(RegisterAdapterRequest) returns (RegisterAdapterReply) {}
  rpc UnregisterAdapter(UnregisterAdapterRequest) returns (UnregisterAdapterReply) {}

  // Subscriber
  rpc RegisterSubscriber(RegisterSubscriberRequest) returns (RegisterSubscriberReply) {}
  rpc UnregisterSubscriber(UnregisterSubscriberRequest) returns (UnregisterSubscriberReply) {}
//  rpc SubscribeToCollections(SubscribeToCollectionsRequest) returns (SubscribeToCollectionsReply) {}

  rpc GetDestinations(GetDestinationsRequest) returns (GetDestinationsReply) {}
  rpc Resync(ResyncRequest) returns (ResyncReply) {}
}

message GetClientCountRequest {
}

message GetClientCountReply {
  bool success = 1;
  string reason = 2;
  uint64 count = 3;
}

message Pipeline {
  uint64 id = 1;
  uint64 sequenece = 2;
  uint64 timestamp = 3;
}

message GetPipelineCountRequest {
}

message GetPipelineCountReply {
  bool success = 1;
  string reason = 2;
  uint64 count = 3;
}

message RegisterRequest {
  string clientID = 1;
}

message RegisterReply {
  bool success = 1;
  string reason = 2;
}

message UnregisterRequest {
  string clientID = 1;
}

message UnregisterReply {
  bool success = 1;
  string reason = 2;
}

message ReleasePipelinesRequest {
  string clientID = 1;
  repeated uint64 pipelines = 2;
}

message ReleasePipelinesReply {
  bool success = 1;
  string reason = 2;
  repeated uint64 failures = 3;
}

message GetPipelinesRequest {
  string clientID = 1;
}

message GetPipelinesReply {
  repeated uint64 pipelines = 1;
}

// Adapter
message RegisterAdapterRequest {
  string clientID = 1;
  string url = 2;
  int64 offset = 3;
}

message RegisterAdapterReply {
  bool success = 1;
  string reason = 2;
}

message UnregisterAdapterRequest {
  string clientID = 1;
}

message UnregisterAdapterReply {
  bool success = 1;
  string reason = 2;
}

// Subscriber
message RegisterSubscriberRequest {
  string subscriberID = 1;
}

message RegisterSubscriberReply {
  bool success = 1;
  string reason = 2;
  uint64 channel = 3;
}

message UnregisterSubscriberRequest {
  string subscriberID = 1;
}

message UnregisterSubscriberReply {
  bool success = 1;
  string reason = 2;
}

message SubscribeToCollectionsRequest {
  string subscriberID = 1;
  repeated string collections = 2;
}

message SubscribeToCollectionsReply {
  bool success = 1;
  string reason = 2;
  repeated string collections = 3;
}

message ResyncRequest {
  string destinationName = 1;
}

message ResyncReply {
  bool success = 1;
  string reason = 2;
}

message Destination {
  string name = 1;
  string host = 2;
  int32 port = 3;
  repeated Pipeline pipelines = 4;
}

message GetDestinationsRequest {
}

message GetDestinationsReply {
  bool success = 1;
  string reason = 2;
  repeated Destination destinations = 3;
}
